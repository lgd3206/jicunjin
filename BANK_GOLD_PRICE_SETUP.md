# 银行金价监控配置指南

## 功能说明

系统已升级，新增**各大银行金价监控**功能，使用极速数据API获取实时银行金价数据。

### 主要变化

1. **数据源增加**：除国际金价外，新增各大银行账户金价
2. **运行频率调整**：从每10分钟改为每30分钟（节省API配额）
3. **邮件增强**：邮件提醒中新增银行金价对比表格

## 配置步骤

### 1. 获取极速数据API密钥

1. 访问 [极速数据官网](https://www.jisuapi.com/)
2. 注册账号并登录
3. 进入"我的API" → "黄金数据"
4. 复制你的 `appkey`

**免费额度**：100次/天（每30分钟运行一次，每天48次，完全够用）

### 2. 配置 GitHub Secrets

1. 进入你的 GitHub 仓库
2. 点击 `Settings` → `Secrets and variables` → `Actions`
3. 点击 `New repository secret`
4. 添加以下密钥：

   - **Name**: `JISUAPI_KEY`
   - **Value**: 你的极速数据API密钥（appkey）

5. 点击 `Add secret` 保存

### 3. 验证配置

配置完成后，可以通过以下方式验证：

#### 方法1：手动触发工作流

1. 进入 `Actions` 标签页
2. 选择 `积存金价格监控` 工作流
3. 点击 `Run workflow` → `Run workflow`
4. 查看运行日志，确认是否成功获取银行金价

#### 方法2：等待自动运行

- 工作流会在每30分钟自动运行
- 查看最新的运行日志，确认银行金价数据

## 邮件效果

配置成功后，邮件提醒中会包含：

### 国际金价部分
- 当前金价
- 24小时最高价/最低价
- 价格波动范围
- 触发提醒的原因

### 银行金价对比表格（新增）
```
🏦 各大银行金价对比
┌──────────┬────────────┬────────────┐
│ 银行     │ 买入价(元/克)│ 卖出价(元/克)│
├──────────┼────────────┼────────────┤
│ 工商银行 │ 520.50     │ 525.80     │
│ 建设银行 │ 520.30     │ 525.60     │
│ 中国银行 │ 520.40     │ 525.70     │
│ ...      │ ...        │ ...        │
└──────────┴────────────┴────────────┘
```

## 技术细节

### 修改的文件

1. **run_once.py**
   - 新增 `fetch_bank_gold_prices()` 函数
   - 修改 `main()` 函数，同时获取国际金价和银行金价
   - 调整历史价格保存逻辑（48条记录，24小时）

2. **notifications/email_notifier.py**
   - 邮件模板增加银行金价对比表格
   - 自动格式化银行数据为HTML表格

3. **.github/workflows/gold-monitor.yml**
   - cron 从 `*/10 * * * *` 改为 `*/30 * * * *`
   - 新增 `JISUAPI_KEY` 环境变量

4. **config/config_loader.py**
   - 环境变量列表中添加 `JISUAPI_KEY` 支持

### API 调用频率

- **运行频率**：每30分钟一次
- **每天运行次数**：48次
- **API免费额度**：100次/天
- **剩余额度**：52次（可用于手动触发或其他用途）

### 数据来源

- **国际金价**：gold-api.com / metals.dev（免费，无需密钥）
- **银行金价**：极速数据API（需要密钥，免费额度100次/天）

## 常见问题

### Q1: 如果不配置 JISUAPI_KEY 会怎样？

A: 系统会正常运行，只是不会显示银行金价数据。邮件中只包含国际金价信息。

### Q2: API 额度用完了怎么办？

A:
- 免费额度：100次/天
- 当前使用：48次/天
- 如果额度不足，可以：
  1. 调整运行频率（修改 cron 表达式）
  2. 升级到付费套餐
  3. 暂时禁用银行金价功能（删除 JISUAPI_KEY）

### Q3: 如何查看 API 使用情况？

A: 登录极速数据官网，进入"我的API"查看今日调用次数和剩余额度。

### Q4: 银行金价数据包含哪些银行？

A: 极速数据API提供的银行包括：
- 工商银行、建设银行、中国银行、农业银行
- 交通银行、招商银行、浦发银行
- 等主流银行的账户金价数据

## 下一步操作

1. ✅ 获取极速数据API密钥
2. ✅ 在 GitHub Secrets 中配置 JISUAPI_KEY
3. ✅ 手动触发工作流验证配置
4. ✅ 等待邮件提醒，查看效果

## 技术支持

如有问题，请查看：
- GitHub Actions 运行日志
- 极速数据API文档：https://www.jisuapi.com/api/gold/
- 项目 Issues 页面

---

**更新时间**: 2026-02-10
**版本**: v2.0 - 银行金价监控版
